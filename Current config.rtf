{\rtf1\ansi\ansicpg1252\cocoartf2865
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;\f1\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red209\green209\blue209;\red72\green153\blue58;\red23\green23\blue23;
\red70\green137\blue204;\red165\green165\blue165;\red226\green189\blue173;\red194\green126\blue101;\red167\green197\blue152;
\red205\green138\blue215;\red212\green214\blue154;\red212\green214\blue154;\red23\green23\blue23;\red209\green209\blue209;
\red194\green126\blue101;\red165\green165\blue165;}
{\*\expandedcolortbl;;\cssrgb\c85490\c85490\c85490;\cssrgb\c34118\c65098\c29020;\cssrgb\c11765\c11765\c11765;
\cssrgb\c33725\c61176\c83922;\cssrgb\c70588\c70588\c70588;\cssrgb\c90980\c78824\c73333;\cssrgb\c80784\c56863\c47059;\cssrgb\c70980\c80784\c65882;
\cssrgb\c84706\c62745\c87451;\cssrgb\c86275\c86275\c66667;\cssrgb\c86275\c86275\c66667;\cssrgb\c11765\c11765\c11765;\cssrgb\c85490\c85490\c85490;
\cssrgb\c80784\c56863\c47059;\cssrgb\c70588\c70588\c70588;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 === Package File 1: luften.yaml ===\
\pard\pardeftab720\partightenfactor0

\f1 \cf2 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ==============================================\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # L\'fcften Assistant \'97 HA + Zigbee + iOS (County Down friendly)\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Place this file at: config/packages/luften.yaml\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Requires: Zigbee temp/humidity sensors + OpenWeather integration + iOS app\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # ==============================================\cf2 \cb1 \strokec2 \
\
\cf5 \cb4 \strokec5 homeassistant\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 customize_glob\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf7 \cb4 \strokec7 "\cf5 \strokec5 sensor.*_dew_point\cf7 \strokec7 "\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:thermometer-water\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ---- USER-TUNABLE SETTINGS (visible in HA UI \uc0\u8594  Settings \u8594  Devices & Services \u8594  Helpers) ----\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 input_number\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_base_minutes_winter\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Base Minutes (Winter)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 3\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 20\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 1\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf8 \strokec8 min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:timer\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_base_minutes_summer\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Base Minutes (Summer)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 45\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 1\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf8 \strokec8 min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:timer\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 25\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_additional_minutes_per_2c_gap\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Extra Minutes per 2\'b0C Dew Point Gap\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 10\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 1\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf8 \strokec8 min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:timer-plus\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 2\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_preferred_morning_hour\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Preferred Morning Check Hour\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 12\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 1\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf8 \strokec8 h\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:weather-sunset-up\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 9\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_preferred_evening_hour\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Preferred Evening Check Hour\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 15\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 22\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 1\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf8 \strokec8 h\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:weather-sunset-down\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 17\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_min_gap_c\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Notify when gap \uc0\u8805  (\'b0C)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 15\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 slider\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:thermometer-chevron-down\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 2.0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_notify_cooldown_min\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Re-notify cooldown (min)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 240\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:timer-outline\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 60\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_surface_temp_offset\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Surface Temp Offset (\'b0C)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 2\cf2 \cb1 \strokec2 \
\
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb4 \strokec5 input_boolean\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_suppress_if_rain\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Suppress if Raining\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:weather-rainy\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf5 \cb4 \strokec5 true\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_suppress_if_freezing\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Suppress if Outdoor < 2\'b0C\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:snowflake\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf5 \cb4 \strokec5 true\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_suppress_if_windy\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Suppress if Wind > 30 km/h\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:weather-windy\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf5 \cb4 \strokec5 false\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_quiet_hours\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Quiet Hours (No Notifications)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:moon-waning-crescent\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf5 \cb4 \strokec5 false\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ---- TEMPLATE SENSORS ----\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Update these entity IDs to match your paired Zigbee sensors & weather integration.\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Example assumed entities:\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   sensor.sonoff1_temperature / sensor.sonoff1_humidity\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   sensor.sonoff2_temperature    / sensor.sonoff2_humidity\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Weather (MET Office):\'9b\'9b\'9b\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   weather.met_office_saintfield\cf2 \cb1 \strokec2 \
\
\cf5 \cb4 \strokec5 template\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 sensor\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Living Room Dew Point\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_living_room_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set T = states('sensor.sonoff1_temperature') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set RH = states('sensor.sonoff1_humidity') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if T == 0 or RH == 0 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ 0 | float \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set a = 17.62 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set b = 243.12 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set gamma = (a * T / (b + T)) + (RH / 100.0) | log %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ (b * gamma / (a - gamma)) | round(1) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% endif %\}\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Bedroom Dew Point\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_bedroom_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set T = states('sensor.sonoff2_temperature') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set RH = states('sensor.sonoff2_humidity') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if T == 0 or RH == 0 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ 0 | float \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set a = 17.62 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set b = 243.12 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set gamma = (a * T / (b + T)) + (RH / 100.0) | log %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ (b * gamma / (a - gamma)) | round(1) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% endif %\}\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6           \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Outdoor Dew Point\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_outdoor_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ state_attr('weather.met_office_saintfield', 'dew_point') \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Outdoor Wind Speed (km/h)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_outdoor_wind_kmh\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 km/h\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ state_attr('weather.met_office_saintfield', 'wind_speed')|float(0)|round(1) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Base Minutes (Seasonal)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_base_minutes_seasonal\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set m = now().month %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set winter = states('input_number.luften_base_minutes_winter') | float(5) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set summer = states('input_number.luften_base_minutes_summer') | float(25) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if m in [12,1,2] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ winter | round(0) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% elif m in [6,7,8] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ summer | round(0) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% elif m in [3,4,5] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ ((winter + summer)/2) | round(0) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ ((winter * 0.6 + summer * 0.4)) | round(0) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% endif %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Suggestion Living Room (min)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_suggestion_living_room_min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set base = states('sensor.luften_base_minutes_seasonal') | float(10) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set add2 = states('input_number.luften_additional_minutes_per_2c_gap') | float(2) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_in = states('sensor.living_room_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_out = states('sensor.outdoor_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set gap = dp_in - dp_out %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if gap <= 0 %\} 0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\} \{\{ (base + (gap // 2 | int) * add2) | round(0) \}\} \{% endif %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Suggestion Bedroom (min)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_suggestion_bedroom_min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set base = states('sensor.luften_base_minutes_seasonal') | float(10) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set add2 = states('input_number.luften_additional_minutes_per_2c_gap') | float(2) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_in = states('sensor.bedroom_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_out = states('sensor.outdoor_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set gap = dp_in - dp_out %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if gap <= 0 %\} 0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\} \{\{ (base + (gap // 2 | int) * add2) | round(0) \}\} \{% endif %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Preferred Window (Now)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_preferred_window_now\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set h = now().hour %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set mh = states('input_number.luften_preferred_morning_hour') | int(9) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set eh = states('input_number.luften_preferred_evening_hour') | int(17) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ 'morning' if h == mh else ('evening' if h == eh else 'none') \}\}\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ---- NOTIFY FALLBACK ----\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # Update 'notify.mobile_app_pauls11' to your device notify service in HA.\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 # If unknown, we also push a persistent_notification.\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 script\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_notify\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 notify.mobile_app_pauls11\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Luften\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Living Room: Open Windows for \{\{states('sensor.luften_suggestion_living_room_min') \}\} minutes\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Luften (Fallback)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Living Room: open Windows for \{\{ states('sensor.luften_suggestion_living_room_min') \}\} minutes\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_notify_ios_fallback\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Notify (iOS + fallback)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6        \cf3 \cb4 \strokec3 # iOS push (optional \'96 keep or comment)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 notify.mobile_app_pauls11\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Living Room: \{\{ states('sensor.luften_suggestion_living_room_min') \}\} min Bedroom: \{\{ states('sensor.luften_suggestion_bedroom_min') \}\} min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Fallback so the script always works\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Living Room: \{\{ states('sensor.luften_suggestion_living_room_min') \}\} min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Bedroom: \{\{ states('sensor.luften_suggestion_bedroom_min') \}\} min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ---- AUTOMATIONS ----\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 automation\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_check_at_preferred_hours_0\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Check at Preferred Hours Original\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 single\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 time_pattern\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 minutes\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 0\cf7 \cb4 \strokec7 "\cf6 \cb4 \strokec6          \cf3 \cb4 \strokec3 # top of every hour\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Only at the two preferred hours\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set h = now().hour %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set mh = states('input_number.luften_preferred_morning_hour')|int(9) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set eh = states('input_number.luften_preferred_evening_hour')|int(17) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ h == mh or h == eh \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Quiet hours off\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 input_boolean.luften_quiet_hours\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 off\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Suppressions (respect your toggles)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set freeze_on = is_state('input_boolean.luften_suppress_if_freezing','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set rain_on   = is_state('input_boolean.luften_suppress_if_rain','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set windy_on  = is_state('input_boolean.luften_suppress_if_windy','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set t_out = state_attr('weather.met_office_saintfield','temperature')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wstate = states('weather.met_office_saintfield') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wet = wstate in ['rainy','pouring','snowy','snowy-rainy','hail','exceptional'] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set ws = states('sensor.luften_outdoor_wind_kmh')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wind_limit = 30 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ (not freeze_on or t_out > 0) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not rain_on or not wet) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not windy_on or ws < wind_limit) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Minimum dew-point gap so we don\'92t ping for tiny differences\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_out = states('sensor.outdoor_dew_point')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_l  = states('sensor.living_room_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_b  = states('sensor.bedroom_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set gap   = max(dp_l - dp_out, dp_b - dp_out) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set min_gap = states('input_number.luften_min_gap_c')|float(2) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ gap >= min_gap \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 script.luften_notify_ios_fallback\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_opportunistic_every_15m\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften: Opportunistic check (every 15 min)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 single\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 time_pattern\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 minutes\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 /15\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 input_boolean.luften_quiet_hours\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 off\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set freeze_on = is_state('input_boolean.luften_suppress_if_freezing','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set rain_on   = is_state('input_boolean.luften_suppress_if_rain','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set windy_on  = is_state('input_boolean.luften_suppress_if_windy','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set t_out = state_attr('weather.met_office_saintfield','temperature')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wstate = states('weather.met_office_saintfield') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wet = wstate in ['rainy','pouring','snowy','snowy-rainy','hail','exceptional'] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set ws = states('sensor.luften_outdoor_wind_kmh')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wind_limit = 30 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ (not freeze_on or t_out > 0) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not rain_on or not wet) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not windy_on or ws < wind_limit) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_out = states('sensor.outdoor_dew_point')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_l  = states('sensor.living_room_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_b  = states('sensor.bedroom_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set gap   = max(dp_l - dp_out, dp_b - dp_out) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set min_gap = states('input_number.luften_min_gap_c')|float(2) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ gap >= min_gap \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Cooldown so we don\'92t spam\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set last = state_attr('automation.luften_opportunistic_every_15m','last_triggered') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set mins = states('input_number.luften_notify_cooldown_min')|int(60) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ last is none or (now() - last).total_seconds() > mins*60 \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 script.luften_notify_ios_fallback\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_hourly_sanity_check\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Hourly Sanity Check (noisy off by default)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial_state\cf6 \cb4 \strokec6 : \cf5 \cb4 \strokec5 false\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 time_pattern\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 minutes\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 /30\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 input_boolean.luften_quiet_hours\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 off\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 variables\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 msg\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf5 \strokec5 -\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 LR: \{\{ states('sensor.luften_suggestion_living_room_min') \}\} min;\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 BR: \{\{ states('sensor.luften_suggestion_bedroom_min') \}\} min;\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Window: \{\{ states('sensor.luften_preferred_window_now') \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Check\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ msg \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_notify_on_calendar_start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften: Notify when local calendar event starts\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Pause L\'fcften when the calendar event begins\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 single\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Quiet hours must be off\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 input_boolean.luften_quiet_hours\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 off\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Suppressions (respect toggles)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set freeze_on = is_state('input_boolean.luften_suppress_if_freezing','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set rain_on   = is_state('input_boolean.luften_suppress_if_rain','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set windy_on  = is_state('input_boolean.luften_suppress_if_windy','on') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set t_out = state_attr('weather.met_office_saintfield','temperature')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wstate = states('weather.met_office_saintfield') %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wet = wstate in ['rainy','pouring','snowy','snowy-rainy','hail','exceptional'] %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set ws = states('sensor.luften_outdoor_wind_kmh')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set wind_limit = 30 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ (not freeze_on or t_out > 0) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not rain_on or not wet) and\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8    (not windy_on or ws < wind_limit) \}\}\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6       \cf3 \cb4 \strokec3 # Require a minimum dew-point gap\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_out = states('sensor.outdoor_dew_point')|float(99) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_l  = states('sensor.living_room_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_b  = states('sensor.bedroom_dew_point')|float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set gap   = max(dp_l - dp_out, dp_b - dp_out) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set min_gap = states('input_number.luften_min_gap_c')|float(2) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ gap >= min_gap \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 script.luften_notify_ios_fallback\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 # ---- LOVELACE SUGGESTED VIEW (if in YAML mode you can include; otherwise build in UI) ----\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 lovelace\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 storage\cf2 \cb1 \strokec2 \
\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 \
\
=== Package File 2: luften_dynamic.yaml ===\
\pard\pardeftab720\partightenfactor0

\f1 \cf3 \cb4 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   L\'fcften Dynamic Ventilation Package (Adaptive Mode)\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   Uses humidity trends + dew point gap + weather data\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\
\cf5 \cb4 \strokec5 sensor\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf3 \cb4 \strokec3 # --- Rolling humidity trend over 12h ---\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 statistics\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Luften Humidity Drop Rate\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 sensor.sonoff1_humidity\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 state_characteristic\cf6 \cb4 \strokec6 : \cf8 \strokec8 mean\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max_age\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 hours\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 12\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 sampling_size\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 48\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb4 \strokec5 template\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf3 \cb4 \strokec3 # --- Calculate optimal L\'fcften duration ---\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 sensor\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Luften Optimal Duration\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 min\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:timer-cog\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set dp_gap = states('sensor.luften_dewpoint_delta') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set outdoor_temp = state_attr('weather.met_office_saintfield', 'temperature') | float(10) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set avg_drop = states('sensor.luften_humidity_drop_rate') | float(1) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set base = states('sensor.luften_base_minutes_seasonal') | float(10) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set adjustment = (dp_gap * 2) - (outdoor_temp / 5) + (avg_drop * 0.3) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ [base + adjustment, 3] | max | round(0) \}\}\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   Dynamic L\'fcften Pause / Resume Automation\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 automation\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_dynamic_pause_resume\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic Pause/Resume Heating\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 Uses Luften Optimal Duration to control Castle thermostat dynamically\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 when L\'fcften calendar events start and end.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 restart\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 end\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 end\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 choose\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf5 \cb4 \strokec5 conditions\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ trigger.id == 'start' \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 variables\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 duration\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('sensor.luften_optimal_duration') | int(10) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Starting L\'fcften ventilation \'97 pausing heat for \{\{ duration \}\} min.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.turn_off\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 delay\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 minutes\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ duration \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_hvac_mode\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 hvac_mode\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 heat\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Resumed Castle heating after dynamic L\'fcften window.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf5 \cb4 \strokec5 conditions\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ trigger.id == 'end' \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_hvac_mode\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 hvac_mode\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 heat\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Calendar end \uc0\u8594  ensured Castle heating resumed.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_dynamic_calendar_announce\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic Calendar Override\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 When L\'fcften calendar event starts, announce or log the adaptive window length\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 and display it in the HA UI.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 single\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 variables\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 duration\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('sensor.luften_optimal_duration') | int(10) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 event_title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ trigger.calendar_event.summary | default('L\'fcften') \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Adaptive Window\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 \{\{ event_title \}\} \uc0\u8594  Adaptive duration set to \{\{ duration \}\} min.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ event_title \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Adaptive L\'fcften duration: \{\{ duration \}\} min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 (Calculated from dew-point \uc0\u916  and humidity trend)\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6           \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_dynamic_calendar_announce\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Dynamic Calendar Override\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 When L\'fcften calendar event starts, announce or log the adaptive window length\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 and display it in the HA UI.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 single\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 variables\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 duration\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('sensor.luften_optimal_duration') | int(10) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf5 \cb4 \strokec5 event_title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ trigger.calendar_event.summary | default('L\'fcften') \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Adaptive Window\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 \{\{ event_title \}\} \uc0\u8594  Adaptive duration set to \{\{ duration \}\} min.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ event_title \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Adaptive L\'fcften duration: \{\{ duration \}\} min\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 (Calculated from dew-point \uc0\u916  and humidity trend)\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #   L\'fcften Test Button (creates 5-minute event)\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\
\cf5 \cb4 \strokec5 input_button\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_test_event\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Trigger L\'fcften Test Event\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 icon\cf6 \cb4 \strokec6 : \cf8 \strokec8 mdi:calendar-plus\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb4 \strokec5 automation\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_test_event_action\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften: Test Calendar Event Button\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 When pressed, creates a 5-minute L\'fcften test event in calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 to simulate real L\'fcften calendar behaviour.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 input_button.luften_test_event\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.create_event\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 summary\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften (Test)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Test L\'fcften trigger via dashboard button\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 start_date_time\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ now() \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 end_date_time\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ now() + timedelta(minutes=5) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 persistent_notification.create\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 title\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Test Event Created\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 A test L\'fcften calendar event was created for 5 minutes.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 This will trigger L\'fcften Dynamic Pause/Resume automation.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8       \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8       \cf2 \cb1 \strokec2 \
\
\
\
\cf6 \cb4 \strokec6        \cf2 \cb1 \strokec2 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 \
\
=== Package File 3: luften_eph.yaml ===\
\pard\pardeftab720\partightenfactor0

\f1 \cf3 \cb4 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec3 ##############################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 ## LUFTEN \uc0\u8596  EPH (CASTLE) \'96 Dew Point Driven Climate Control\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 ##############################################\cf2 \cb1 \strokec2 \
\
\cf5 \cb4 \strokec5 homeassistant\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 customize\cf6 \cb4 \strokec6 : \{\}\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #                  INPUTS / HELPERS\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 input_text\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_climate_entity\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Castle Climate Entity\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_indoor_temp_entity\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Castle Indoor Temperature Entity\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf8 \strokec8 sensor.castle_indoor_temperature\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_indoor_rh_entity\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Castle Indoor Humidity Entity\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf8 \strokec8 sensor.castle_indoor_humidity\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_calendar_entity\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 L\'fcften Castle Calendar Entity\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb4 \strokec5 input_number\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_comfort_temp_day\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Comfort Temp (Day)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 18\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 21\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 20\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_comfort_temp_night\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Comfort Temp (Night)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 17\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 18\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 17\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf5 \cb4 \strokec5 luften_castle_dewpoint_sensitivity\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf8 \strokec8 Dew Point Sensitivity (\'b0C diff trigger)\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 min\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 max\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 step\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 0.5\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 initial\cf6 \cb4 \strokec6 : \cf9 \cb4 \strokec9 2.0\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #                  TEMPLATE SENSORS\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 template\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 sensor\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Castle Indoor Dew Point\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_castle_indoor_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set T = states('sensor.castle_indoor_temperature') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set RH = states('sensor.castle_indoor_humidity') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% if T == 0 or RH == 0 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ 0 | float \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% else %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set a = 17.62 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set b = 243.12 %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{% set gamma = (a * T / (b + T)) + (RH / 100.0) | log %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8   \{\{ (b * gamma) / (a - gamma) | round(1) \}\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% endif %\}\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Outdoor Dew Point\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_castle_outdoor_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ state_attr('weather.met_office_saintfield', 'dew_point') \}\}\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Dew Point Differential\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unique_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_castle_dew_point_diff\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 device_class\cf6 \cb4 \strokec6 : \cf8 \strokec8 temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 unit_of_measurement\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \'b0C\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 state\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set in_dp = states('sensor.luften_castle_indoor_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{% set out_dp = states('sensor.luften_castle_outdoor_dew_point') | float(0) %\}\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf8 \strokec8 \{\{ (in_dp - out_dp) | round(1) \}\}\cf2 \cb1 \strokec2 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #             AUTOMATION: Dew Point \uc0\u8594  Thermostat\cf2 \cb1 \strokec2 \
\cf3 \cb4 \strokec3 #######################################################\cf2 \cb1 \strokec2 \
\cf5 \cb4 \strokec5 automation\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Dew Point Adaptive Heating\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 Adjust Castle thermostat target temperature based on dew point differential.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 If indoor dew point is close to outdoor, lower temp to save energy.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       \cf8 \strokec8 If dew point gap widens (risk of condensation), gently increase heat.\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 mode\cf6 \cb4 \strokec6 : \cf8 \strokec8 restart\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 state\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf8 \strokec8 sensor.luften_castle_indoor_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf8 \strokec8 sensor.luften_castle_outdoor_dew_point\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 for\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 00:05:00\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : []\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 variables\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 diff\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('sensor.luften_castle_dew_point_diff') | float(0) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 sensitivity\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('input_number.luften_castle_dewpoint_sensitivity') | float(2) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 comfort_day\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('input_number.luften_castle_comfort_temp_day') | float(19) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 comfort_night\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ states('input_number.luften_castle_comfort_temp_night') | float(17) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 hour\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ now().hour \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 choose\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf5 \cb4 \strokec5 conditions\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ diff > sensitivity \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 temperature\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ comfort_day + 0.5 \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf5 \cb4 \strokec5 conditions\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ diff < (sensitivity * -1) \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 temperature\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ comfort_day - 1.0 \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           - \cf5 \cb4 \strokec5 conditions\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 condition\cf6 \cb4 \strokec6 : \cf8 \strokec8 template\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 value_template\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ 0 <= diff <= sensitivity \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf5 \cb4 \strokec5 sequence\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6               - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_temperature\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                 \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6                   \cf5 \cb4 \strokec5 temperature\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 \{\{ comfort_day \}\}\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Dew Point Control\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf10 \cb4 \strokec10 >\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6             \cf8 \strokec8 Dew point diff: \{\{ diff \}\}\'b0C \uc0\u8594  thermostat set accordingly.\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   \cf3 \cb4 \strokec3 # \uc0\u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf3 \cb4 \strokec3 # L\'fcften Calendar Integration \'96 Pause & Resume EPH Heating\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   \cf3 \cb4 \strokec3 # \uc0\u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Pause heating (HVAC off)\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_castle_pause_heating\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 When L\'fcften Castle ventilation starts, turn Castle thermostat off temporarily.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 start\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.turn_off\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Ventilation\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Heating paused during L\'fcften Castle ventilation event.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\
\cf6 \cb4 \strokec6   - \cf5 \cb4 \strokec5 alias\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Resume adaptive heating\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 id\cf6 \cb4 \strokec6 : \cf8 \strokec8 luften_castle_resume_heating\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 description\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 When L\'fcften Castle event ends, resume dew-point adaptive heating control.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 trigger\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 platform\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 event\cf6 \cb4 \strokec6 : \cf8 \strokec8 end\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 calendar.luften_time\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6     \cf5 \cb4 \strokec5 action\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.set_hvac_mode\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 target\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 entity_id\cf6 \cb4 \strokec6 : \cf8 \strokec8 climate.castle_thermostat\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 hvac_mode\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 heat\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6       - \cf5 \cb4 \strokec5 service\cf6 \cb4 \strokec6 : \cf8 \strokec8 logbook.log\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6         \cf5 \cb4 \strokec5 data\cf6 \cb4 \strokec6 :\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 name\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 L\'fcften Castle Ventilation\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\cf6 \cb4 \strokec6           \cf5 \cb4 \strokec5 message\cf6 \cb4 \strokec6 : \cf7 \cb4 \strokec7 "\cf8 \cb4 \strokec8 Heating resumed \'96 dew-point adaptive control active.\cf7 \cb4 \strokec7 "\cf2 \cb1 \strokec2 \
\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0 \cf0 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 \
\
=== Automation: automation_name.yaml ===\
- alias: Sync Ember Target to Castle Thermostat\
  description: If Ember target changes externally, update HA thermostat target\
  mode: single\
  trigger:\
  - platform: state\
    entity_id: sensor.castle_target_climate\
  condition:\
  - condition: template\
    value_template: "\{\{ state_attr('climate.castle_thermostat', 'temperature') | float\
      !=\\n   states('sensor.castle_target_climate') | float \}\}\\n"\
  action:\
  - service: climate.set_temperature\
    target:\
      entity_id: climate.castle_thermostat\
    data:\
      temperature: '\{\{ states(''sensor.castle_target_climate'') | float \}\}'\
  id: 66dd1df2b5544a0ea8cbbf2a19677c93\
- id: luften_flip_night_day_mode\
  alias: 'L\'fcften: Flip Night/Day mode'\
  mode: single\
  trigger:\
  - platform: time\
    at: 07:30\
    id: day\
  - platform: time\
    at: '22:30'\
    id: night\
  action:\
  - choose:\
    - conditions:\
      - condition: template\
        value_template: '\{\{ trigger.id == ''day'' \}\}'\
      sequence:\
      - service: input_boolean.turn_off\
        target:\
          entity_id: input_boolean.luften_night_mode\
    - conditions:\
      - condition: template\
        value_template: '\{\{ trigger.id == ''night'' \}\}'\
      sequence:\
      - service: input_boolean.turn_on\
        target:\
          entity_id: input_boolean.luften_night_mode\
- id: '1761554249014'\
  alias: Adaptive Light with Weather and Daylight Saving (UK)\
  description: Adjust IKEA bulb brightness and color based on daylight hours and weather,\
    with automatic off between 22:00\'9607:30.\
  triggers:\
  - entity_id: weather.met_office_saintfield\
    trigger: state\
  - entity_id: sun.sun\
    trigger: state\
  - minutes: /15\
    trigger: time_pattern\
  conditions: []\
  actions:\
  - variables:\
      weather: '\{\{ states(''weather.met_office_saintfield'') \}\}'\
      is_day: '\{\{ is_state(''sun.sun'', ''above_horizon'') \}\}'\
      hour: '\{\{ now().hour \}\}'\
  - choose:\
    - conditions:\
      - condition: template\
        value_template: '\{\{ hour >= 22 or hour < 7 or (hour == 8 and now().minute\
          < 30) \}\}'\
      sequence:\
      - target:\
          entity_id: light.ikea_bulb\
        action: light.turn_off\
    - conditions:\
      - condition: template\
        value_template: '\{\{ is_day and weather == ''sunny'' \}\}'\
      sequence:\
      - target:\
          entity_id: light.ikea_bulb\
        data:\
          brightness_pct: 100\
          color_temp_kelvin: 3000\
        action: light.turn_on\
    - conditions:\
      - condition: template\
        value_template: '\{\{ is_day and weather in [''cloudy'', ''partlycloudy'', ''rainy'',\
          ''windy'', ''exceptional''] \}\}'\
      sequence:\
      - target:\
          entity_id: light.ikea_bulb\
        data:\
          brightness_pct: 100\
          color_temp_kelvin: 3000\
        action: light.turn_on\
    - conditions:\
      - condition: template\
        value_template: '\{\{ not is_day and hour < 22 \}\}'\
      sequence:\
      - target:\
          entity_id: light.ikea_bulb\
        data:\
          brightness_pct: 100\
          color_temp_kelvin: 3000\
        action: light.turn_on\
      - delay: 00:01:00\
      - target:\
          entity_id: light.ikea_bulb\
        action: light.turn_on\
  mode: restart\
\
\
=== Configuration.yaml (relevant sections) ===\
\
# Loads default set of integrations. Do not remove.\
default_config:\
\
# Load frontend themes from the themes folder\
frontend:\
  themes: !include_dir_merge_named themes\
\
automation: !include automations.yaml\
script: !include scripts.yaml\
scene: !include scenes.yaml\
\
# Loads Packages\
homeassistant:\
  packages: !include_dir_named packages\
  \
# Database for Luften Project\
influxdb:\
  host: a0d7b954-influxdb   # standard hostname inside HA add-on network\
  port: 8086\
  database: homeassistant\
  username: homeassistant\
  password: turtle\
  max_retries: 3\
  default_measurement: state\
  include:\
    entities:\
      - sensor.effective_surface_temperature\
      - sensor.sonoff1_temperature\
      - sensor.sonoff1_humidity\
      - sensor.sonoff2_temperature\
      - sensor.sonoff2_humidity\
      - sensor.living_room_dew_point\
      - sensor.bedroom_dew_point\
      - sensor.outdoor_dew_point\
      - sensor.luften_suggestion_living_room_min\
      - sensor.luften_suggestion_bedroom_min\
\
# EPH Ember Sensors\
sensor:\
  # Castle Climate\
  - platform: command_line\
    name: "Castle Climate"\
    command: '/usr/local/bin/python3 /config/scripts/eph_ember.py get_temp "ONE"'\
    unit_of_measurement: "\'b0C"\
    scan_interval: 60\
    \
  - platform: command_line\
    name: "Castle Target Climate"\
    command: '/usr/local/bin/python3 /config/scripts/eph_ember.py get_target "ONE"'\
    unit_of_measurement: "\'b0C"\
    scan_interval: 60\
    \
  - platform: template\
    sensors:\
      effective_surface_temperature:\
        friendly_name: "Effective Surface Temperature"\
        unit_of_measurement: "C"\
        value_template: >\
          \{% set t_out= state_attr('weather.met_office_saintfield','temperature')|float(0) %\}\
          \{% set offset = states('input_number.luften_surface_temp_offset')|float(2) %\}\
          \{\{ (t_out + offset) | round(1) \}\}\
          \
# ===========================\
# L\'fcften Dewpoint Delta Logic\
# ===========================\
template:\
  - sensor:\
      - name: "L\'fcften Dewpoint Delta"\
        unique_id: luften_dewpoint_delta_internal\
        unit_of_measurement: "\'b0C"\
        device_class: temperature\
        state_class: measurement\
        state: >\
          \{% set temp = states('sensor.castle_climate') | float(0) %\}\
          \{% set dew = states('sensor.living_room_dew_point') | float(0) %\}\
          \{\{ (temp - dew) | round(2) \}\}\
mqtt:\
  sensor:\
    # Indoor Temperature (Castle)\
    - name: "Castle Climate MQTT"\
      unique_id: luften_castle_climate\
      state_topic: "telegraf/luften/castle_climate"\
      value_template: "\{\{ states('sensor.castle_climate') \}\}"\
      unit_of_measurement: "\'b0C"\
      device_class: temperature\
      state_class: measurement\
    \
    # Living Room Dew Point\
    - name: "Living Room Dew Point MQTT"\
      unique_id: luften_living_room_dew_point_mqtt\
      state_topic: "telegraf/luften/living_room_dew_point"\
      value_template: "\{\{ states('sensor.living_room_dew_point') \}\}"\
      unit_of_measurement: "\'b0C"\
      device_class: temperature\
      state_class: measurement\
    \
    # Bedroom Dew Point\
    - name: "Bedroom Dew Point MQTT"\
      unique_id: luften_bedroom_dew_point_mqtt\
      state_topic: "telegraf/luften/bedroom_dew_point"\
      value_template: "\{\{ states('sensor.bedroom_dew_point') \}\}"\
      unit_of_measurement: "\'b0C"\
      device_class: temperature\
      state_class: measurement\
    \
    # Outdoor Dew Point\
    - name: "Outdoor Dew Point MQTT"\
      unique_id: luften_outdoor_dew_point_mqtt\
      state_topic: "telegraf/luften/outdoor_dew_point"\
      value_template: "\{\{ states('sensor.outdoor_dew_point') \}\}"\
      unit_of_measurement: "\'b0C"\
      device_class: temperature\
      state_class: measurement\
    \
    # L\'fcften Dewpoint Delta\
    - name: "L\'fcften Dewpoint Delta MQTT"\
      unique_id: luften_dewpoint_delta_mqtt\
      state_topic: "telegraf/luften/dewpoint_delta"\
      value_template: "\{\{ states('sensor.luften_dewpoint_delta') \}\}"\
      unit_of_measurement: "\'b0C"\
      device_class: temperature\
      state_class: measurement\
    \
    # Indoor Humidity (Sonoff or Castle if available)\
    - name: "Castle Humidity MQTT"\
      unique_id: luften_castle_humidity_mqtt\
      state_topic: "telegraf/luften/castle_humidity"\
      value_template: >\
        \{% if states('sensor.sonoff1_humidity') not in ['unknown','unavailable'] %\}\
          \{\{ states('sensor.sonoff1_humidity') \}\}\
        \{% elif states('sensor.sonoff2_humidity') not in ['unknown','unavailable'] %\}\
          \{\{ states('sensor.sonoff2_humidity') \}\}\
        \{% else %\}\
          0\
        \{% endif %\}\
      unit_of_measurement: "%"\
      device_class: humidity\
      state_class: measurement\
    \
    # Outdoor Humidity (if available)\
    - name: "Outdoor Humidity MQTT"\
      unique_id: luften_outdoor_humidity_mqtt\
      state_topic: "telegraf/luften/outdoor_humidity"\
      value_template: "\{\{ states('sensor.sonoff2_humidity') \}\}"\
      unit_of_measurement: "%"\
      device_class: humidity\
      state_class: measurement\
\
\
# EPH Ember Climate Control\
climate:\
  - platform: generic_thermostat\
    name: "Castle Thermostat"\
    heater: switch.living_room_heating\
    target_sensor: sensor.castle_climate\
    min_temp: 16\
    max_temp: 21\
    ac_mode: false\
    target_temp: 20\
    cold_tolerance: 0.3\
    hot_tolerance: 0\
\
# EPH Ember Switches  \
switch:\
  - platform: command_line\
    switches:\
      castle_heating:\
        command_on: '/usr/local/bin/python3 /config/scripts/eph_ember.py set_advance "ONE" on'\
        command_off: '/usr/local/bin/python3 /config/scripts/eph_ember.py set_advance "ONE off'\
        command_state: '/usr/local/bin/python3 /config/scripts/eph_ember.py get_status "ONE"'\
        value_template: '\{\{ value == "on" \}\}'\
          \
# Call EPH Automations          \
shell_command:\
  set_castle_target: '/usr/local/bin/python3 /config/scripts/eph_ember.py set_target "\{\{ zone \}\}" "\{\{ temp \}\}"'\
# Set environment variables for credentials\
  set_eph_credentials: 'export EPH_EMAIL="polphert@gmail.com" && export EPH_PASSWORD="GoteamKp108!"'\
\
\
pyscript:\
  allow_all_imports: true\
  hass_is_global: true\
\
\
\
\
cat /config/packages/luften.yaml | pbcopy\
\
\pard\pardeftab720\partightenfactor0

\f1 \cf11 \cb4 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec11 cat\cf2 \strokec2  \cf8 \strokec8 /config/packages/l
\f0 \cf0 \cb1 \kerning1\expnd0\expndtw0 \outl0\strokewidth0 uften.yaml
\f1 \cf6 \cb4 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec6 |\cf2 \strokec2  \cf11 \strokec11 xclip\cf2 \strokec2  \cf8 \strokec8 -selection\cf2 \strokec2  \cf8 \strokec8 clipboard\
\
\pard\pardeftab720\partightenfactor0
\cf11 \strokec11 cat\cf2 \strokec2  \cf8 \strokec8 /config/packages/luften.yaml\cf2 \strokec2  \cf6 \strokec6 |\cf2 \strokec2  \cf11 \strokec11 xsel\cf2 \strokec2  \cf8 \strokec8 --clipboard\cf2 \strokec2  \cf8 \strokec8 --input\cf2 \cb1 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf2 \
\pard\pardeftab720\partightenfactor0
\cf12 \cb13 \outl0\strokewidth0 cat\cf14  \cf15 /config/automations.yaml\cf16 |\cf14  \cf12 xclip\cf14  \cf15 -selection\cf14  \cf15 clipboard\
\pard\pardeftab720\partightenfactor0
\cf2 \cb1 \outl0\strokewidth0 \strokec2 \
cat /config/packages/luften.yaml\
}
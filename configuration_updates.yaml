# Updates to add to your existing configuration.yaml
# Add these entities to your existing influxdb: include: entities: section

# =============================================================================
# ADD THESE TO YOUR EXISTING INFLUXDB ENTITIES LIST
# =============================================================================
# Add these lines to your existing influxdb: include: entities: section:

      # Additional heating analytics entities (add to your existing list)
      - climate.castle_thermostat  # Change from climate.one to climate.castle_thermostat
      - input_datetime.zone_one_heating_start
      - sensor.daily_heating_cost
      - sensor.monthly_heating_cost_projection
      - sensor.heating_efficiency_trend
      - sensor.weekly_heating_efficiency
      - sensor.monthly_heating_cycles_average
      - sensor.monthly_average_heating_duration
      - sensor.monthly_total_heating_time
      - sensor.daily_heating_time
      - sensor.monthly_heating_cycles

# =============================================================================
# UPDATED INFLUXDB SECTION - Replace your existing influxdb section with this:
# =============================================================================
influxdb:
  host: a0d7b954-influxdb   # Your existing hostname
  port: 8086
  database: homeassistant
  username: homeassistant
  password: turtle
  max_retries: 3
  default_measurement: state
  include:
    entities:
      # Your existing Luften sensors
      - sensor.effective_surface_temperature
      - sensor.sonoff1_temperature
      - sensor.sonoff1_humidity
      - sensor.sonoff2_temperature
      - sensor.sonoff2_humidity
      - sensor.living_room_dew_point
      - sensor.bedroom_dew_point
      - sensor.outdoor_dew_point
      - sensor.luften_suggestion_living_room_min
      - sensor.luften_suggestion_bedroom_min
      
      # Updated heating entities (corrected entity names)
      - binary_sensor.zone_one_heating_active
      - counter.zone_one_heating_cycles_today
      - sensor.zone_one_average_heating_duration
      - input_number.zone_one_total_heating_time_today
      - sensor.daily_heating_efficiency_zone_one
      - climate.castle_thermostat  # CHANGED from climate.one
      - sensor.zone_one_heating_time_today
      - sensor.zone_one_heating_cycles_count_today
      - input_datetime.zone_one_heating_start
      
      # New InfluxDB-powered analytics entities
      - sensor.daily_heating_cost
      - sensor.monthly_heating_cost_projection
      - sensor.heating_efficiency_trend
      - sensor.weekly_heating_efficiency
      - sensor.monthly_heating_cycles_average
      - sensor.monthly_average_heating_duration
      - sensor.monthly_total_heating_time
      
      # Utility meter entities
      - sensor.daily_heating_time
      - sensor.monthly_heating_cycles

# =============================================================================
# KEY CHANGES NEEDED IN YOUR CONFIG
# =============================================================================

# 1. UPDATE YOUR CLIMATE ENTITY NAME:
# In your EPH Ember Climate Control section, you have:
# climate:
#   - platform: generic_thermostat
#     name: "Castle Thermostat"  # This creates climate.castle_thermostat
# 
# But your InfluxDB includes climate.one - this needs to be changed to climate.castle_thermostat

# 2. ADD RECORDER CONFIGURATION (optional but recommended):
recorder:
  purge_keep_days: 365  # Keep 1 year of detailed data
  include:
    entities:
      # Add heating entities to long-term statistics
      - binary_sensor.zone_one_heating_active
      - counter.zone_one_heating_cycles_today
      - sensor.zone_one_average_heating_duration
      - sensor.daily_heating_efficiency_zone_one
      - sensor.daily_heating_cost
      - climate.castle_thermostat

# =============================================================================
# PACKAGE INTEGRATION CHECK
# =============================================================================
# Your packages are loaded with:
# homeassistant:
#   packages: !include_dir_named packages
#
# This means you can add these files to your /config/packages/ directory:
# 1. heating_analytics_package.yaml
# 2. influxdb_heating_config.yaml
# 3. pyephember2_heating_detection.yaml (optional fallback)